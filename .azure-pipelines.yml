trigger:
  branches:
    include:
      - main

pr:
  branches:
    include:
      - main

pool:
  name: Default

steps:
  - checkout: self

  - task: NodeTool@0
    inputs:
      versionSpec: '20.x'
    displayName: Use Node.js 20

  - script: |
      node --version
      npm --version
      node init.js
    displayName: Run hello world app

  - script: |
      node -e "const { execSync } = require('child_process'); const output = execSync('node init.js').toString().trim(); if (output === 'Hello, CI/CD Pipeline!') { console.log('Hello world test passed'); } else { console.error('Hello world test failed. Actual output: ' + output); process.exit(1); }"
    displayName: Test hello world output
